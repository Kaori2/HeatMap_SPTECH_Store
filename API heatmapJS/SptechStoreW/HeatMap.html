<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exemplo de Heatmap - SPTECH Store</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .heatmap {
            width: 600px;
            height: 510px;
            /*Imagem de fundo do mapa */
            background-image: url('../MapaLocal.png');
            background-repeat: no-repeat;
            background-size: cover;
            border: 1px solid #ccc;
        }

        .controles {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-top: 10px;
            padding-bottom: 10px;

            h3 {
                margin: 0%;
            }

            p {
                margin: 0%;
            }
        }

        .data-hora {
            display: flex;
            flex-direction: row;
            gap: 10px;
        }
    </style>
    <script src="https://unpkg.com/heatmap.js"></script> <!-- Importar a biblioteca heatmap.js -->
</head>

<body>
    <!-- Controles para filtrar os dados por intervalo de data e hora -->
    <div class="controles">
        <div>
            <h3>Intervalo de Tempo</h3>
            <p>Selecione um intervalo de tempo para visualizar os dados:</p>
        </div>
        <div class="data-hora">
            <label for="data-inicial">Data Inicial:</label>
            <input type="date" id="data-inicial" name="data-inicial" value="2023-10-01">
            <label for="hora-inicial">Hora Inicial:</label>
            <input type="time" id="hora-inicial" name="hora-inicial" value="11:00">
        </div>
        <div class="data-hora">
            <label for="data-final">Data Final:</label>
            <input type="date" id="data-final" name="data-final" value="2024-10-01">
            <label for="hora-final">Hora Final:</label>
            <input type="time" id="hora-final" name="hora-final" value="12:00">
        </div>

        <button onclick="filtrarDadosPorDataHora()">Aplicar Intervalo de Tempo</button>
    </div>

    <!-- Div para exibir o heatmap -->
    <div class="heatmap"></div>

    <script>
        // Criar uma instância do heatmap.js
        var instanciaHeatmap = h337.create({
            container: document.querySelector('.heatmap')
        });

        // Estrutura de dados separada por locais, cada local tem várias capturas de dados com datas e horários
        var dadosPorLocal = {
            local1: [
                { x: 100, y: 175, value: 30, radius: 130, dataHora: '2024-10-01T10:30' },
                { x: 100, y: 175, value: 40, radius: 130, dataHora: '2024-10-01T11:15' },
                { x: 100, y: 175, value: 50, radius: 130, dataHora: '2024-10-01T11:45' }
            ],
            local2: [
                { x: 540, y: 200, value: 60, radius: 100, dataHora: '2024-10-01T11:10' },
                { x: 540, y: 200, value: 70, radius: 100, dataHora: '2024-10-01T11:30' },
                { x: 540, y: 200, value: 80, radius: 100, dataHora: '2024-10-01T12:00' }
            ],
            local3: [
                { x: 320, y: 190, value: 20, radius: 90, dataHora: '2024-10-02T10:45' },
                { x: 320, y: 190, value: 30, radius: 90, dataHora: '2024-10-02T11:20' },
                { x: 320, y: 190, value: 40, radius: 90, dataHora: '2024-10-02T11:50' }
            ],
            local4: [
                { x: 192, y: 350, value: 50, radius: 130, dataHora: '2024-10-02T11:00' },
                { x: 192, y: 350, value: 60, radius: 130, dataHora: '2024-10-02T11:40' },
                { x: 192, y: 350, value: 70, radius: 130, dataHora: '2024-10-02T12:15' }
            ],
            local5: [
                { x: 400, y: 350, value: 30, radius: 130, dataHora: '2024-10-03T11:05' },
                { x: 400, y: 350, value: 40, radius: 130, dataHora: '2024-10-03T11:35' },
                { x: 400, y: 350, value: 50, radius: 130, dataHora: '2024-10-03T12:10' }
            ]
        };

        // Função para converter data e hora em um objeto Date
        function converterParaDataCompleta(data, hora) {
            return new Date(`${data}T${hora}`);
        }

        // Função para aplicar o filtro de intervalo de data e hora e adicionar os dados ao heatmap
        function filtrarDadosPorDataHora() {
            var dataInicial = document.getElementById('data-inicial').value;
            var horaInicial = document.getElementById('hora-inicial').value;
            var dataFinal = document.getElementById('data-final').value;
            var horaFinal = document.getElementById('hora-final').value;

            // Converter os dados e horários em objetos Date
            var dataHoraInicial = converterParaDataCompleta(dataInicial, horaInicial);
            var dataHoraFinal = converterParaDataCompleta(dataFinal, horaFinal);

            if (dataHoraFinal < dataHoraInicial) {
                alert("A data e hora final devem ser maiores ou iguais à data e hora inicial.");
                return;
            }

            // Limpar o heatmap antes de adicionar novos dados
            instanciaHeatmap.setData({ max: 0, data: [] });

            // Percorrer todos os locais
            for (var local in dadosPorLocal) {
                var dadosDoLocal = dadosPorLocal[local];

                // Percorrer cada ponto de dados dentro de um local
                for (var i = 0; i < dadosDoLocal.length; i++) {
                    var ponto = dadosDoLocal[i];
                    var dataHoraPonto = new Date(ponto.dataHora);

                    // Verificar se o ponto de dados está dentro do intervalo de data e hora
                    if (dataHoraPonto >= dataHoraInicial && dataHoraPonto <= dataHoraFinal) {
                        // Usando addData para adicionar os pontos ao heatmap
                        instanciaHeatmap.addData(ponto);
                    }
                }
            }
        }

        // Carregar os dados iniciais
        filtrarDadosPorDataHora();

    </script>

</body>

</html>